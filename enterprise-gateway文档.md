## jupyter enterprise gateway

### enterprise gateway和kernel gateway选用

#### 	在以下情况下使用Enterprise Gateway：
- 有一个由有限资源（GPU，大内存等）组成的大型计算机集群，并且用户需要笔记本电脑提供的这些资源
- 有大量需要访问共享计算群集的用户
- 需要一定数量的高可用性/灾难恢复，以便可以启动另一个网关服务器来服务现有（和远程）内核

#### 在以下情况使用kernel gateway：
- 有一个小的用户池，可以在这些用户之间共享网关服务器的资源（不支持远程内核）
- 希望配置Notebook-http模式的功能，其中特定的Notebook提供HTTP端点

### enterprise gateway的主要做用

1. 内核在jupyter内部启动后，资源受运行所有内核和关联的Spark驱动程序的单个节点上可用资源的限制。如果要用到多语言环境，内核全部堆积在单个容器内部，资源被逐渐耗尽，容易出现单点故障现象
2. 而enterprise gateway 能够在不同服务器上启动内核，从而在整个企业中分配资源利用率
3. 从客户端到内核的安全通信
4. 持久性内核会话

### kernel和笔记本的对应关系

一个ipynb文件会启动一个内核

`session`消息头中的id标识具有状态的唯一实体，例如内核进程或客户端进程。

来自客户端的消息标头中的客户端会话ID在连接到内核的所有客户端中应该是唯一的。当客户端重新连接到内核时，它应该在其消息头中使用相同的客户端会话ID。客户端重新启动时，它应生成一个新的客户端会话ID。

在来自内核的消息标头中的内核会话标识应标识特定的内核进程。如果重新启动内核，则应重新生成内核会话ID。

消息头中的会话ID可用于标识发送实体。例如，如果客户端断开连接并重新连接到内核，并且来自内核的消息具有与断开连接之前不同的内核会话ID，则客户端应假定内核已重新启动。

### 将内核代理到网关后的pip install 

- 如果在记事本中使用!pip install 的magic命令安装包的话，安装的包是在内核中的site-package中

- 如果在terminal中使用pip install 命令，安装的包在jupyter notebook容器中的site-package中（但是笔记本中无法使用该包，因为内核已经不在本地）

kernel的容器是不稳定的，当笔记本的内核被关闭时，内核容器即被销毁

问题：

- 内核容器是自动启动的，没法指定参数，因此无法将!pip install的东西用卷的方式挂载出来
- 内核容器在笔记本内核关闭后自动销毁，在对内核备份的时候很有可能因为内核容器被销毁而失败
- 当
- 当一个节点故障后，jupyter notebook被重启，笔记本shutdown掉，内核随之停止

### enterprise的启动

enterprise启动时 会启动2种镜像

- elyra/kernel-image-puller:dev
  - 添加新节点并在这些节点上自动填充内核映像的功能。
  -  配置使用不同映像的新内核规范并将这些映像拉到所有群集节点的能力。

  kernel-image-puller会在每个节点上都拉取内核镜像并以容器的方式运行在节点上
  
- elyra/enterprise-gateway:dev

